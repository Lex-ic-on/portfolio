---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import HeroTier2 from '../components/HeroTier2.astro';
import ThumbWork from '../components/ThumbWork.astro';

const allWorks = await getCollection('works');
const sortedWorks = allWorks
  .filter((work) => !work.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Layout title="Works - Lex">
  <Header />
  <main class="main">
    <HeroTier2
      dir="1ex.me/Works"
      title="Works"
    />
    <ul class="works-list">
      {sortedWorks.map((work) => (
        <li>
          <ThumbWork
            url={`/works/${work.slug}`}
            src={work.data.thumbnail || '/thumbnails/default.png'}
            title={work.data.title}
            cl={`${work.data.client}, ${work.data.date.toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit' })}`}
          />
        </li>
      ))}
    </ul>
  </main>
  <Footer />
</Layout>

<style>
  .main {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: flex-start;
    min-height: calc(100dvh - var(--header-height));
    padding-top: var(--header-height);
  }

  .works-list {
    margin-left: auto;
    margin-right: auto;
    margin-top: var(--scale-m);
    display: flex;
    flex-direction: column;
    gap: var(--scale-m);
    max-width: calc(60 * var(--scale-t-s) + 5dvw);
  }
</style>
